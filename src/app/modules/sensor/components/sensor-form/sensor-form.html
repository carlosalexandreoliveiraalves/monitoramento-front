<div class="flex flex-col h-full relative">
  
  <div class="flex items-center justify-between mb-6 text-primary">
    <h2 class="text-2xl font-bold flex items-center gap-2">
      <span class="material-symbols-outlined">{{ sensorId ? 'edit' : 'add_circle' }}</span>
      {{ sensorId ? 'Editar' : 'Novo' }} Sensor
    </h2>
    <button (click)="onCancel()" class="text-gray-400 hover:text-gray-600 transition-colors p-1 rounded-full hover:bg-gray-100">
      <span class="material-symbols-outlined">close</span>
    </button>
  </div>

  <div *ngIf="isLoading" class="absolute inset-0 bg-white/70 z-10 flex items-center justify-center">
    <span class="material-symbols-outlined animate-spin text-3xl text-primary">progress_activity</span>
  </div>

  <form [formGroup]="form" (ngSubmit)="onSubmit()" class="flex flex-col gap-5">
    
    <div class="flex flex-col gap-1">
      <label class="font-semibold text-gray-600 text-sm">Identifica√ß√£o do Sensor</label>
      <div class="relative">
        <span class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-lg">sensors</span>
        <input 
          type="text" 
          formControlName="name" 
          class="pl-10 input-dashboard"
          placeholder="Ex: Sonda pH Tanque 2"
          [ngClass]="{'border-red-300 focus:ring-red-200': form.get('name')?.invalid && form.get('name')?.touched}"
        >
      </div>
      <span *ngIf="form.get('name')?.invalid && form.get('name')?.touched" class="text-red-500 text-xs mt-1">Nome obrigat√≥rio.</span>
    </div>

    <div class="flex flex-col gap-1">
      <label class="font-semibold text-gray-600 text-sm">Tipo de Leitura</label>
      <div class="relative">
        <span class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-lg">category</span>
        <select formControlName="sensorType" class="pl-10 input-dashboard bg-white appearance-none cursor-pointer">
          <option value="Temperature">üå°Ô∏è Temperatura</option>
          <option value="Ph">üíß pH</option>
          <option value="Turbidity">üå´Ô∏è Turbidez</option>
        </select>
        <span class="material-symbols-outlined absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none">expand_more</span>
      </div>
    </div>

    <div class="flex flex-col gap-1">
      <label class="font-semibold text-gray-600 text-sm">Conectado ao Dispositivo</label>
      <div class="relative">
        <span class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-lg">router</span>
        <select 
          formControlName="deviceId" 
          class="pl-10 input-dashboard bg-white appearance-none cursor-pointer"
          [ngClass]="{'border-red-300 focus:ring-red-200': form.get('deviceId')?.invalid && form.get('deviceId')?.touched}">
          <option [ngValue]="null" disabled>Selecione o hardware...</option>
          <option *ngFor="let dev of deviceList" [value]="dev.id">{{ dev.name }} ({{ dev.property?.address || 'Sem local' }})</option>
        </select>
        <span class="material-symbols-outlined absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none">expand_more</span>
      </div>
      <span *ngIf="form.get('deviceId')?.invalid && form.get('deviceId')?.touched" class="text-red-500 text-xs mt-1">V√≠nculo com dispositivo obrigat√≥rio.</span>
    </div>

    <div class="flex gap-3 mt-4 pt-4 border-t border-gray-100">
      <button type="button" (click)="onCancel()" class="w-1/3 py-3 rounded-lg border border-gray-300 text-gray-600 hover:bg-gray-50 transition-colors font-medium">Cancelar</button>
      <button type="submit" [disabled]="form.invalid || isLoading" class="w-2/3 py-3 rounded-lg bg-purple-600 text-white shadow hover:bg-purple-700 hover:shadow-lg disabled:opacity-50 transition-all active:scale-95 font-medium flex justify-center items-center gap-2">
        <span *ngIf="!isLoading">Salvar Sensor</span>
        <span *ngIf="isLoading" class="material-symbols-outlined animate-spin text-sm">progress_activity</span>
      </button>
    </div>
  </form>
</div>